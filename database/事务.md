# 事务

## 特性
ACID是事务的四个重要特性：原子性、一致性、隔离性、持久性。

- 原子性(Atomicity): 一个事务的所有操作，要么全部执行，要么全部不执行。
- 一致性(Consistency): 执行事务时保持数据库从一个一致的状态变更到另一个一致的状态。
- 隔离性(Isolation): 确保多个事务之间并发的修改不会影响一致性。
- 持久性(Durability): 一个事务完成后，即使数据库发生故障，它对数据库的改变应该永久保存在数据库中。

一致性由`主外键约束`保证，持久性由`预写日志(WAL)`和数据库管理系统的`恢复子系统`保证，原子性、隔离性则由`事务管理器`和`MVCC`来控制。

## 事务隔离级别
为了解决[并发事务引起的问题](./并发事务引起的问题.md)，`ANSI SQL`标准定义了四类隔离级别，分别是：**读未提交**，**读已提交**，**可重复读**，**序列化**。每种隔离级别规定了一个事务与其他事务的隔离程度。

隔离级别越高，越能保证数据的完整性和一致性，但是需要更多的系统资源，增加了事务阻塞其他事务的概率，对并发性能的影响也越大，吞吐量也会更低；低级别的隔离级别一般支持更高的并发处理，并拥有更低的系统开销，但增加了并发引发的副作用的影响 对于多数应用程序，优先考虑 `Read Committed` 隔离级别 它能够避免脏读，而且具有较好的并发性能。

### 读未提交（Read Uncommitted）
在该隔离级别下，每个事务都可以看到其他未提交事务的执行结果，也就是会有脏读的情况。

### 读已提交（Read Committed）
一个事务只能看到已经提交事务对关联数据所做的改变的隔离需求。避免了脏读的发生。

### 可重复读（Repeatable Read）
确保同一事务内多次读取数据时，会看到同样的数据行。能解决脏读、不可重复读的问题。

### 序列化（Serializable）
最高的隔离级别，强制事务排序，串行执行。能够解决脏读、不可重复读、幻读的问题。


### 隔离级别的范围
隔离级别可以在**全局**，**当前会话**，**当前事务**下进行设置，范围越小的优先级越高。